# .env.example
# WebFuzzing Pro - Variables de Entorno

# Entorno de ejecuciÃ³n
FLASK_ENV=development
WF_ENVIRONMENT=development

# ConfiguraciÃ³n de la aplicaciÃ³n
WF_CONFIG_PATH=config.json
WF_LOG_LEVEL=INFO
WF_MAX_WORKERS=10

# Base de datos
WF_DATABASE_PATH=webfuzzing.db
WF_BACKUP_INTERVAL=86400

# ConfiguraciÃ³n web
WF_WEB_HOST=127.0.0.1
WF_WEB_PORT=5000
WF_WEB_DEBUG=true
WF_SECRET_KEY=your-secret-key-here

# ConfiguraciÃ³n API
WF_API_HOST=127.0.0.1
WF_API_PORT=8000
WF_API_KEY=your-api-key-here

# Notificaciones Telegram
WF_TELEGRAM_ENABLED=false
WF_TELEGRAM_BOT_TOKEN=
WF_TELEGRAM_CHAT_ID=

# Notificaciones Email
WF_EMAIL_ENABLED=false
WF_EMAIL_SMTP_SERVER=smtp.gmail.com
WF_EMAIL_SMTP_PORT=587
WF_EMAIL_USERNAME=
WF_EMAIL_PASSWORD=
WF_EMAIL_RECIPIENTS=

# Herramientas externas
WF_FFUF_ENABLED=true
WF_FFUF_PATH=ffuf
WF_DIRSEARCH_ENABLED=true
WF_DIRSEARCH_PATH=python3 -m dirsearch

# ConfiguraciÃ³n de fuzzing
WF_FUZZING_TIMEOUT=5
WF_FUZZING_DELAY=0.1
WF_FUZZING_MAX_PATH_LENGTH=12

# Docker
DOCKER_BUILDKIT=1
COMPOSE_DOCKER_CLI_BUILD=1

# Makefile
.PHONY: help install test run clean docker deploy

# Variables
PYTHON = python3
PIP = pip3
DOCKER = docker
DOCKER_COMPOSE = docker-compose

# Colores para output
RED = \033[0;31m
GREEN = \033[0;32m
YELLOW = \033[0;33m
NC = \033[0m # No Color

help: ## Mostrar ayuda
	@echo "WebFuzzing Pro - Comandos disponibles:"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

install: ## Instalar dependencias y configurar entorno
	@echo "$(GREEN)ğŸ“¦ Instalando WebFuzzing Pro...$(NC)"
	$(PYTHON) -m venv venv
	. venv/bin/activate && $(PIP) install -r requirements.txt
	$(PYTHON) scripts/install.py
	@echo "$(GREEN)âœ… InstalaciÃ³n completada$(NC)"

install-dev: ## Instalar dependencias de desarrollo
	@echo "$(GREEN)ğŸ”§ Instalando dependencias de desarrollo...$(NC)"
	. venv/bin/activate && $(PIP) install -r requirements-dev.txt
	@echo "$(GREEN)âœ… Dependencias de desarrollo instaladas$(NC)"

test: ## Ejecutar tests
	@echo "$(GREEN)ğŸ§ª Ejecutando tests...$(NC)"
	$(PYTHON) tests/test_fuzzing_engine.py
	@echo "$(GREEN)âœ… Tests completados$(NC)"

test-coverage: ## Ejecutar tests con coverage
	@echo "$(GREEN)ğŸ§ª Ejecutando tests con coverage...$(NC)"
	. venv/bin/activate && pytest --cov=. tests/
	@echo "$(GREEN)âœ… Tests con coverage completados$(NC)"

run: ## Ejecutar aplicaciÃ³n en modo desarrollo
	@echo "$(GREEN)ğŸš€ Iniciando WebFuzzing Pro...$(NC)"
	$(PYTHON) main.py --mode all

run-web: ## Ejecutar solo dashboard web
	@echo "$(GREEN)ğŸŒ Iniciando dashboard web...$(NC)"
	$(PYTHON) main.py --mode web

run-api: ## Ejecutar solo API REST
	@echo "$(GREEN)ğŸ”— Iniciando API REST...$(NC)"
	$(PYTHON) main.py --mode api

run-scan: ## Ejecutar solo escaneo manual
	@echo "$(GREEN)ğŸ” Ejecutando escaneo manual...$(NC)"
	$(PYTHON) main.py --mode scan

setup: ## Configurar entorno despuÃ©s de la instalaciÃ³n
	@echo "$(GREEN)âš™ï¸ Configurando entorno...$(NC)"
	$(PYTHON) scripts/setup_environment.py
	@echo "$(GREEN)âœ… Entorno configurado$(NC)"

migrate: ## Ejecutar migraciones de base de datos
	@echo "$(GREEN)ğŸ”„ Ejecutando migraciones...$(NC)"
	$(PYTHON) scripts/migrate_db.py
	@echo "$(GREEN)âœ… Migraciones completadas$(NC)"

clean: ## Limpiar archivos temporales y cache
	@echo "$(YELLOW)ğŸ§¹ Limpiando archivos temporales...$(NC)"
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf .coverage htmlcov/ .pytest_cache/
	@echo "$(GREEN)âœ… Limpieza completada$(NC)"

clean-data: ## Limpiar datos de desarrollo (Â¡CUIDADO!)
	@echo "$(RED)âš ï¸ Limpiando datos de desarrollo...$(NC)"
	rm -rf data/resultados/*
	rm -f data/descubiertos.txt
	rm -f webfuzzing.db
	rm -rf logs/*
	@echo "$(YELLOW)âœ… Datos de desarrollo limpiados$(NC)"

docker-build: ## Construir imagen Docker
	@echo "$(GREEN)ğŸ³ Construyendo imagen Docker...$(NC)"
	$(DOCKER) build -t webfuzzing-pro:latest .
	@echo "$(GREEN)âœ… Imagen Docker construida$(NC)"

docker-run: ## Ejecutar en Docker
	@echo "$(GREEN)ğŸ³ Ejecutando en Docker...$(NC)"
	$(DOCKER_COMPOSE) up -d
	@echo "$(GREEN)âœ… WebFuzzing Pro ejecutÃ¡ndose en Docker$(NC)"

docker-stop: ## Detener contenedores Docker
	@echo "$(YELLOW)ğŸ³ Deteniendo contenedores...$(NC)"
	$(DOCKER_COMPOSE) down
	@echo "$(GREEN)âœ… Contenedores detenidos$(NC)"

docker-logs: ## Ver logs de Docker
	$(DOCKER_COMPOSE) logs -f

deploy-dev: ## Deploy en entorno de desarrollo
	@echo "$(GREEN)ğŸš€ Deploying a desarrollo...$(NC)"
	$(PYTHON) scripts/deploy.py --env development
	@echo "$(GREEN)âœ… Deploy de desarrollo completado$(NC)"

deploy-staging: ## Deploy en entorno de staging
	@echo "$(GREEN)ğŸš€ Deploying a staging...$(NC)"
	$(PYTHON) scripts/deploy.py --env staging --docker
	@echo "$(GREEN)âœ… Deploy de staging completado$(NC)"

deploy-prod: ## Deploy en entorno de producciÃ³n
	@echo "$(GREEN)ğŸš€ Deploying a producciÃ³n...$(NC)"
	$(PYTHON) scripts/deploy.py --env production --systemd --docker
	@echo "$(GREEN)âœ… Deploy de producciÃ³n completado$(NC)"

backup: ## Crear backup completo
	@echo "$(GREEN)ğŸ’¾ Creando backup...$(NC)"
	mkdir -p backups/manual_$(shell date +%Y%m%d_%H%M%S)
	cp -r data/ backups/manual_$(shell date +%Y%m%d_%H%M%S)/
	cp config.json backups/manual_$(shell date +%Y%m%d_%H%M%S)/ 2>/dev/null || true
	cp webfuzzing.db backups/manual_$(shell date +%Y%m%d_%H%M%S)/ 2>/dev/null || true
	@echo "$(GREEN)âœ… Backup creado$(NC)"

lint: ## Ejecutar linting
	@echo "$(GREEN)ğŸ” Ejecutando linting...$(NC)"
	. venv/bin/activate && flake8 . --max-line-length=88 --exclude=venv
	@echo "$(GREEN)âœ… Linting completado$(NC)"

format: ## Formatear cÃ³digo con black
	@echo "$(GREEN)ğŸ¨ Formateando cÃ³digo...$(NC)"
	. venv/bin/activate && black . --exclude=venv
	@echo "$(GREEN)âœ… CÃ³digo formateado$(NC)"

security: ## Ejecutar anÃ¡lisis de seguridad
	@echo "$(GREEN)ğŸ”’ Ejecutando anÃ¡lisis de seguridad...$(NC)"
	. venv/bin/activate && bandit -r . -x venv/,tests/
	@echo "$(GREEN)âœ… AnÃ¡lisis de seguridad completado$(NC)"

docs: ## Generar documentaciÃ³n
	@echo "$(GREEN)ğŸ“š Generando documentaciÃ³n...$(NC)"
	. venv/bin/activate && sphinx-build -b html docs/ docs/_build/
	@echo "$(GREEN)âœ… DocumentaciÃ³n generada$(NC)"

status: ## Mostrar estado del sistema
	@echo "$(GREEN)ğŸ“Š Estado del sistema:$(NC)"
	@echo "Python: $(shell $(PYTHON) --version)"
	@echo "Entorno virtual: $(shell test -d venv && echo "âœ… Creado" || echo "âŒ No encontrado")"
	@echo "ConfiguraciÃ³n: $(shell test -f config.json && echo "âœ… Configurado" || echo "âŒ No configurado")"
	@echo "Base de datos: $(shell test -f webfuzzing.db && echo "âœ… Creada" || echo "âŒ No encontrada")"
	@echo "Docker: $(shell $(DOCKER) --version 2>/dev/null || echo "âŒ No instalado")"

update: ## Actualizar dependencias
	@echo "$(GREEN)ğŸ”„ Actualizando dependencias...$(NC)"
	. venv/bin/activate && $(PIP) install --upgrade -r requirements.txt
	@echo "$(GREEN)âœ… Dependencias actualizadas$(NC)"

check: ## Verificar instalaciÃ³n completa
	@echo "$(GREEN)âœ… Verificando instalaciÃ³n...$(NC)"
	$(PYTHON) scripts/test_system.py
	@echo "$(GREEN)âœ… VerificaciÃ³n completada$(NC)"

# Alias comunes
dev: run ## Alias para run
start: run ## Alias para run
stop: docker-stop ## Alias para docker-stop
build: docker-build ## Alias para docker-build